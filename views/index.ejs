<% include header.ejs -%>
<canvas id="success_chart" width="1000" height="400"></canvas>
<p>&nbsp;</p>
<canvas id="platform_chart" width="1000" height="400"></canvas>
<p>&nbsp;</p>

<script>
  var labels = []
    , datasets = {
      'ios': []
    , 'android': []
    , 'successful': []
    , 'failed': []
    , 'total': []
    };

  var aggregations = <%-JSON.stringify(aggregations)%>
    , keys = ['ios', 'android', 'successful', 'failed', 'total'];

  for (var i = 0; i < aggregations.length; i++) {
    var hours = new Date(aggregations[i].start_time).getHours()
    labels.unshift(((hours % 12) || 12)+(hours >= 12 ? "pm" : "am"));
    for (var j = 0; j < keys.length; j++) {
      datasets[keys[j]].unshift(aggregations[i][keys[j]]);
    }
  }

  var platformChart = new Chart(document.getElementById("success_chart").getContext("2d")).Line({
    labels: labels
  , datasets: [{
      label: "Successful"
    , fillColor: "rgba(220,220,220,0.2)"
    , strokeColor: "rgba(220,220,220,1)"
    , pointColor: "rgba(220,220,220,1)"
    , pointStrokeColor: "#fff"
    , pointHighlightFill: "#fff"
    , pointHighlightStroke: "rgba(220,220,220,1)"
    , data: datasets['successful']
    }, {
      label: "Failed"
    , fillColor: "rgba(151,187,205,0.2)"
    , strokeColor: "rgba(151,187,205,1)"
    , pointColor: "rgba(151,187,205,1)"
    , pointStrokeColor: "#fff"
    , pointHighlightFill: "#fff"
    , pointHighlightStroke: "rgba(151,187,205,1)"
    , data: datasets['failed']
    }]
  });

  var platformChart = new Chart(document.getElementById("platform_chart").getContext("2d")).Line({
    labels: labels
  , datasets: [{
      label: "iOS"
    , fillColor: "rgba(220,220,220,0.2)"
    , strokeColor: "rgba(220,220,220,1)"
    , pointColor: "rgba(220,220,220,1)"
    , pointStrokeColor: "#fff"
    , pointHighlightFill: "#fff"
    , pointHighlightStroke: "rgba(220,220,220,1)"
    , data: datasets['ios']
    }, {
      label: "Android"
    , fillColor: "rgba(151,187,205,0.2)"
    , strokeColor: "rgba(151,187,205,1)"
    , pointColor: "rgba(151,187,205,1)"
    , pointStrokeColor: "#fff"
    , pointHighlightFill: "#fff"
    , pointHighlightStroke: "rgba(151,187,205,1)"
    , data: datasets['android']
    }]
  });
</script>
<% include footer.ejs -%>
